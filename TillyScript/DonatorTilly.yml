DonatorTilly: 
    type: assignment 
    interact scripts: 
    - 10 DonatorTillyInteraction 
    actions: 
        on assignment: 
            - trigger name:click toggle:true 
            - trigger name:chat toggle:true radius:4 
            - lookclose state:true 

DonatorTillyInteraction: 
    type: interact 
    steps: 
        1: 
            click trigger: 
                script: 
                - ^playsound location:<npc.location> sound:ENTITY_VILLAGER_TRADING pitch:1.5 
                - ^random 4 
                - ^chat "<yellow>Hello adventurer! Would you like to use our 'services'?" 
                - ^chat "<yellow>Hi there pretty! Are you in for some personal time?" 
                - ^chat "<yellow>Greetings! Would you like a private session?" 
                - ^chat "<yellow>Welcome hotshot! Want to have some fun?" 
                - ^narrate "<gray>[<red>1<gray>]<white> Private session <gray>(<blue>100 doubloons<gray>)" 
                - ^narrate "<gray>[<red>2<gray>]<white> No thanks." 
                - trigger name:chat toggle:true radius:4 
            chat trigger: 
                1: 
                    trigger: <&lb>/1/<&rb> - Private session 
                    script: 
                    - ^if <player.money> >= 100 { 
                        - ^take money qty:100 
                        #update the player;s flag
                        - flag player TimesVisitedTilly:+:1 
                        - ^trigger name:chat toggle:false 
                        - ^engage duration:15s 
                        - narrate "<blue>You have paid <white>100 doubloons<blue> for a private session." 
#                        - walkto l@-1457,66,101,world 
                        - wait 4 
                        - ^playsound location:<npc.location> sound:ENTITY_VILLAGER_AMBIENT pitch:1.7 
                        - ^chat "<yellow>Don't be shy, follow me!" 
#                        - ^teleport n@230 location:-1454,68,98,world 
#                        - walkto l@-1449,70,108,world 
                        - wait 10 
                        - zap step:2 
                        - ^playsound location:<npc.location> sound:ENTITY_VILLAGER_AMBIENT pitch:1.7 
                        - ^chat "<yellow>Ok, click on me to start our private session!" 
                        } else { 
                        - ^playsound location:<npc.location> sound:ENTITY_VILLAGER_AMBIENT pitch:1.7 
                        - ^chat "<yellow>Sorry, looks like you don't have enough money!" 
                        } 
                2: 
                    trigger: <&lb>/2/<&rb> - No thanks 
                    script: 
                    - ^playsound location:<npc.location> sound:ENTITY_VILLAGER_AMBIENT pitch:1.7 
                    - ^chat "<yellow>Such a shame, we could have had so much fun!" 
        2: 
            click trigger: 
                script: 
                - ^playsound location:<npc.location> sound:ENTITY_VILLAGER_YES pitch:1.7 
                - ^chat "<yellow>Alright, let's get into position!" 
                - wait 2 
#                - execute as_op "warp tillysex" silent 
#                - teleport -1450,72,108,world 
#                - look <player> <npc.location> duration:10s 
                - look <player> location:-1447,69,98,world duration:25s 
                - ^cast blindness power:6 duration:25s 
#                - ^cast slow power:6 duration:12 
#                - ^cast jump power:128 duration:12 
                - wait 2 
                - ^playsound location:<npc.location> sound:ENTITY_VILLAGER_YES pitch:1.7 
                - ^random 4 
                - ^chat "<yellow>Prepare for a wild ride honey!" 
                - ^chat "<yellow>I'm going to rock your socks off!" 
                - ^chat "<yellow>You won't be able to sit properly when I'm done with you!" 
                - ^chat "<yellow>This is going to be the experience of your lifetime!" 
                - wait 3 
                - narrate "SEX PART SKIPPED, EASIER FOR TESTING" 
                - ^playsound location:<npc.location> sound:ENTITY_VILLAGER_YES pitch:1.7 
                - wait 2 
                - ^playsound location:<npc.location> sound:ENTITY_VILLAGER_AMBIENT pitch:1.7 
                - random 4 
                - ^chat "<yellow>I hope you enjoyed yourself, please come again!" 
                - ^chat "<yellow>That was amazing, I should be paying YOU!" 
                - ^chat "<yellow>I hope you were please by our service!" 
                - ^chat "<yellow>How did you like those moves, hotshot?" 
                - wait 3 
                - ^playsound location:<npc.location> sound:ENTITY_VILLAGER_AMBIENT pitch:1.7 
                - random 3 
                - ^chat "<yellow>I'm going back downstairs now, bye!" 
                - ^chat "<yellow>I am going back to my counter, goodbye!" 
                - ^chat "<yellow>I better get back downstairs, cya!" 
                - wait 2 
                - ^playeffect location:<npc.location> effect:heart qty:30 
                - ^playsound location:<player.location> sound:ENTITY_FIREWORK_BLAST 
#                - ^teleport n@230 location:-1453,66,101,world 
                - ^narrate "<blue>Tilly vanishes in a cloud of hearts!" 
                - wait 3 
                - random { 
                    - repeat 1 { 
                        - narrate "<blue>Uh oh! You've been infected with pox!" 
                        - ^execute as_op "disease infect <player.name> Pox" silent 
                        - ^playsound location:<player.location> sound:custom.girlyscream1 custom 
                    } 
                    - repeat 1 { 
                        - narrate "<blue>Uh oh! You've been infected with the plague!" 
                        - ^execute as_op "disease infect <player.name> Plague" silent 
                        - ^playsound location:<player.location> sound:custom.girlyscream2 custom 
                    } 
                    - repeat 1 { 
                        - narrate "<blue>Oh no! You've been robbed of <white>500 doubloons<blue>!" 
                        - ^take money qty:500 
                        - ^playsound location:<player.location> sound:custom.instrumentbanjobad custom 
                    } 
                    - repeat 1 { 
                        - narrate "<blue>This experience made you feel like you're king of the world!" 
                        - ^cast health_boost power:100 duration:60 
                        - heal 
                        - ^cast regeneration power:6 duration:60 
                        - ^playsound location:<player.location> sound:custom.effectffvictory custom 
                    } 
                    - repeat 1 { 
                        - narrate "<blue>This experience has invigorated you!" 
                        - ^execute as_op "disease cure <player.name>" silent 
                        - ^cast saturation power:6 duration:600 
                        - ^cast regeneration power:6 duration:60 
                        - ^playsound location:<player.location> sound:custom.effectman custom 
                    } 
                    - repeat 1 { 
                        - narrate "<blue>Oh boy! Tilly has infected you with swamp fever!" 
                        - ^execute as_op "disease infect <player.name> SwampFever" silent 
                        - ^playsound location:<player.location> sound:custom.instrumentflutebad custom 
                    } 
                } 
                - zap step:1 
                - trigger name:chat toggle:true radius:4 
                
DonatorTillyUsage:
    type: command
    name: TillyUsage
    Description: Lists how many times people have used Tilly
    Usage: /TillyUsage <&lt>List Length<&gt> 
    script:    
    - define counter 1
    - define listMax <context.args.get[0].as_int>
     
    - narrate <server.list_players>
    - define playerList <server.list_players.sort[TillyUsageSort]>
    
    
    - narrate <def[playerList]>
    
    #add check to make sure passed arg is valid
    - narrate "<gray>==========<yellow>Tilly's Usage<gray>=========="
    - while <def[counter].is[OR_LESS].than[<def[listMax]>]> {
        - define currentPlayer <def[PlayerList].get[<def[counter]>]>
        - narrate "<def[currentPlayer].name>: times visited <def[currentPlayer].flag[TimesVisitedTilly].as_int||0> time(s)"
        - define counter <def[counter].add[1]>
        }
    - narrate "<gray>=============================="
    
TillyUsageSort:
    type: Procedure
    definitions: player1|player2
    script:
    - define timesP1 <def[player1].flag[TimesVisitedTilly].as_int||0>
    - define timesP2 <def[player2].flag[TimesVisitedTilly].as_int||0>
   
    - if <def[timesP1].is[EQUALS].than[<def[timesP2]>]> {
        - determine 0
    }
   
    - if <def[timesP1].is[MORE].than[<def[timesP2]>]> {
        - determine -1
    }
    else {
        - determine 1
    }